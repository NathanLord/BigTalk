Object subclass: #BigTalkSemanticAnalyzer	instanceVariableNames: 'env errors'	classVariableNames: ''	poolDictionaries: ''	category: 'BigTalk-SemanticAnalyzer'!!BigTalkSemanticAnalyzer methodsFor: 'initialize-release' stamp: 'jws 12/2/2024 11:14'!initialize	super initialize.	env := BTEnvironment new.	errors := OrderedCollection new.! !!BigTalkSemanticAnalyzer methodsFor: 'accessing' stamp: 'jws 12/2/2024 11:13'!env	^ env! !!BigTalkSemanticAnalyzer methodsFor: 'accessing' stamp: 'jws 12/2/2024 11:13'!env: anObject	env := anObject.! !!BigTalkSemanticAnalyzer methodsFor: 'accessing' stamp: 'jws 12/2/2024 11:13'!errors	^ errors! !!BigTalkSemanticAnalyzer methodsFor: 'accessing' stamp: 'jws 12/2/2024 11:13'!errors: anObject	errors := anObject.! !!BigTalkSemanticAnalyzer methodsFor: 'utility' stamp: 'nl 12/10/2024 11:13'!apply: args to: params 		| argStream paramStream |	argStream := ReadStream on: args.	paramStream := ReadStream on: params.	[argStream atEnd]		whileFalse:			[paramStream next set: argStream next].	[argStream atEnd ifFalse: (BTArityError signal: 'incorrect number of arguments sent in function call').	paramStream atEnd ifFalse: (BTArityError signal: 'incorrect number of arguments sent in function call').]		on: BTError		do: [:ex | self errors add: ex].	! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 15:41'!visitBTArgumentList: aBTArgumentList 		[^aBTArgumentList arguments		collect: [:each | each accept: self]]			on: BTError			do: [:ex | self errors add: ex]! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 16:30'!visitBTArithmeticOperator: aBTArithmeticOperator 		| opSelector |	opSelector := aBTArithmeticOperator opSymbol.	opSelector = #/ ifTrue: [opSelector := #//].	opSelector = #MOD ifTrue: [opSelector := #\\].	^opSelector asSymbol! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 15:22'!visitBTAssignmentStatement: aBTAssignmentStatement 		[| var value |	var := env variable: aBTAssignmentStatement variableId.	value := aBTAssignmentStatement expression accept: self.	var set: value]		on: BTError		do: [:ex | errors add: ex].! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 17:13'!visitBTBinaryExpression: aBTBinaryExpression 		| arg1 arg2 |	arg1 := aBTBinaryExpression arg1 accept: self.	arg2 := aBTBinaryExpression arg2 accept: self.		[aBTBinaryExpression operator checkArg1: arg1 arg2:arg2.]		on: BTError		do: [:ex | self errors add: ex].	^aBTBinaryExpression operator. 			! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/6/2024 15:16'!visitBTCompoundStatement: aBTCompoundStatement 		aBTCompoundStatement statements		do: [:each | each accept: self]! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 15:06'!visitBTFunction: aBTFunction 		[env		declare: aBTFunction identifier		method: aBTFunction]			on: BTError			do: [:ex | self errors add: ex]! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 15:38'!visitBTFunctionCall: aBTFunctionCall 		[| funcName func args params result |	funcName := aBTFunctionCall identifier.	func := env method: funcName.	args := aBTFunctionCall arguments accept: self.	env activate.	params := func parameters accept: self.	self apply: args to: params.	env declare: funcName variable: (BTVariable type: func returnType).	func methodBody accept: self.	result := env variable: funcName.	env deactivate.	^result get]		on: BTError		do: [:ex | self errors add: ex]! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 16:18'!visitBTIfThenElseStatement: aBTIfThenElseStatement 		[BTBooleanType default checkType: (aBTIfThenElseStatement expression accept: self)]		on: BTError		do: [:ex | self errors add: ex].				[aBTIfThenElseStatement trueStatement accept: self]			on: BTError			do: [:ex | self errors add: ex].					[aBTIfThenElseStatement falseStatement accept: self]			on: BTError			do: [:ex | self errors add: ex].! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 16:17'!visitBTIfThenStatement: aBTIfThenStatement 	[BTBooleanType default checkType: (aBTIfThenStatement expression accept: self)]		on: BTError		do: [:ex | self errors add: ex].				[aBTIfThenStatement trueStatement accept: self]			on: BTError			do: [:ex | self errors add: ex].! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 15:46'!visitBTMethodBody: aBTMethodBody 		aBTMethodBody variables accept: self.	aBTMethodBody statement accept: self.! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'jws 12/2/2024 11:22'!visitBTMethods: aBTMethods 	aBTMethods declarations		do: [:each | each accept: self]! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 15:42'!visitBTParameterList: aBTParameterList 		[^aBTParameterList parameters		collect: [:each | each accept: self]]			on: BTError			do: [:ex | self errors add: ex]! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 14:51'!visitBTProcedure: aBTProcedure 		[env		declare: aBTProcedure identifier		method: aBTProcedure]			on: BTError			do: [:ex | self errors add: ex]! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 15:30'!visitBTProcedureCall: aBTProcedureCall 		[| procName proc args params |	procName := aBTProcedureCall identifier.	proc := env method: procName.	args := aBTProcedureCall arguments accept: self.	env activate.	params := proc parameters accept: self.	self apply: args to: params.	proc methodBody accept: self.	env deactivate.	]		on: BTError		do: [:ex | self errors add: ex]! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'jws 12/2/2024 11:21'!visitBTProgram: aBTProgram 		aBTProgram variables accept: self.	aBTProgram methods accept: self.	aBTProgram statement accept: self.! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 15:49'!visitBTRelationalOperator: aBTRelationalOperator 		^aBTRelationalOperator opSymbol! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/6/2024 15:15'!visitBTVariableDeclaration: aBTVariableDeclaration 		| var |	var := BTVariable type: aBTVariableDeclaration type.	[env 		declare: aBTVariableDeclaration name 		variable: var]			on: BTError			do: [:ex | errors add: ex].	^var	! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 15:23'!visitBTVariableReference: aBTVariableReference 		^(env variable: aBTVariableReference identifier) get! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'jws 12/2/2024 11:22'!visitBTVariables: aBTVariables 	aBTVariables declarations		do: [:each | each accept: self]! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 16:26'!visitBTWhileStatement: aBTWhileStatement 		[BTBooleanType default checkType: (aBTWhileStatement expression accept: self)]		on: BTError		do: [:ex | self errors add: ex].				[aBTWhileStatement statement accept: self]			on: BTError			do: [:ex | self errors add: ex].! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 14:32'!visitBTWriteLine: aBTWriteLine 		Transcript cr! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 14:32'!visitBTliteralBoolean: aBTliteralBoolean 		^aBTliteralBoolean value! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'jws 12/2/2024 11:29'!visitBTliteralInteger: aBTliteralInteger 		^BTIntegerType default anyValue! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'jws 12/2/2024 11:27'!visitBTliteralString: aBTliteralString 		^BTStringType default anyValue! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 16:10'!visitWriteBoolean: aBTWriteBoolean 		[BTBooleanType default checkType: (aBTWriteBoolean expression accept: self)]		on: BTError		do: [:ex | self errors add: ex]! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'nl 12/7/2024 14:27'!visitWriteInteger: aBTWriteInteger 		[BTIntegerType default checkType: (aBTWriteInteger expression accept: self)]		on: BTError		do: [:ex | self errors add: ex]! !!BigTalkSemanticAnalyzer methodsFor: 'visiting' stamp: 'jws 12/2/2024 11:32'!visitWriteString: aBTWriteString 		[BTStringType default checkType: (aBTWriteString expression accept: self)]		on: BTError		do: [:ex | self errors add: ex]! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!BigTalkSemanticAnalyzer class	instanceVariableNames: ''!!BigTalkSemanticAnalyzer class methodsFor: 'analyzing' stamp: 'jws 12/2/2024 11:16'!analyze: aProgramString	| ast analyzer |	ast := BigTalkParser parse: aProgramString.	analyzer := self new.	ast accept: analyzer.	^analyzer errors! !TestCase subclass: #BigTalkSemanticAnalyzerTestCase	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'BigTalk-SemanticAnalyzer'!!BigTalkSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'nl 12/7/2024 16:28'!testBadArithmeticProgram	| errors |	errors := BigTalkSemanticAnalyzer analyze: self badArithmeticProgram.	self deny: errors isEmpty.	errors inspect.! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'nl 12/7/2024 16:19'!testBadConditionalProgram	| errors |	errors := BigTalkSemanticAnalyzer analyze: self badConditionalProgram.	self deny: errors isEmpty.	errors inspect.! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'jws 12/2/2024 11:29'!testBadNano	| errors |	errors := BigTalkSemanticAnalyzer analyze: self nanoBadProgram.	self deny: errors isEmpty.! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'nl 12/7/2024 14:30'!testBadVaraiblesProgram	| errors |	errors := BigTalkSemanticAnalyzer analyze: self badVariablesProgram.	self deny: errors isEmpty.	errors inspect.! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'nl 12/7/2024 16:24'!testBadWhileConditionalProgram	| errors |	errors := BigTalkSemanticAnalyzer analyze: self badWhileConditionalProgram.	self deny: errors isEmpty.	errors inspect.! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'nl 12/7/2024 15:33'!testIncorrectTypeAssignmentProgram	| errors |	errors := BigTalkSemanticAnalyzer analyze: self incorrectTypeAssignmentProgram.	self deny: errors isEmpty.	errors inspect.! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'nl 12/7/2024 15:05'!testMultFuncProgram	| errors |	errors := BigTalkSemanticAnalyzer analyze: self multFuncProgram.	self deny: errors isEmpty.	errors inspect.! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'nl 12/7/2024 14:41'!testMultProcProgram	| errors |	errors := BigTalkSemanticAnalyzer analyze: self multProcProgram.	self deny: errors isEmpty.	errors inspect.! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'jws 12/2/2024 11:19'!testNano	| errors |	errors := BigTalkSemanticAnalyzer analyze: self nanoProgram.	self assert: errors isEmpty.! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'nl 12/7/2024 15:26'!testUndeclaredProcProgram	| errors |	errors := BigTalkSemanticAnalyzer analyze: self undeclaredProcProgram.	self deny: errors isEmpty.	errors inspect.! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'running' stamp: 'nl 12/7/2024 15:10'!testUndeclaredVariablesProgram	| errors |	errors := BigTalkSemanticAnalyzer analyze: self undeclaredVariablesProgram.	self deny: errors isEmpty.	errors inspect.! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'nl 12/7/2024 16:28'!badArithmeticProgram	^'program 	variables		msg : string		do		msg <- msg + 2		'! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'nl 12/7/2024 15:54'!badConditionalProgram	^'program 	variables		msg : string		do		if msg then			writeLine		'! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'nl 12/6/2024 11:09'!badVariablesProgram	^'program	variables		answer : integer		msg : string		answer : string		isIt : boolean	do		[answer <- 42		writeInteger answer		writeLine		msg <- "Hello, World!!"		writeString msg		writeLine		isIt <- true		writeBoolean isIt		writeLine]'! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'nl 12/7/2024 16:24'!badWhileConditionalProgram	^'program 	variables		msg : string		do		while msg do			writeLine		'! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'nl 12/4/2024 15:18'!factorialProgram	^'program	variables		msg : string	methods		function factorial(n:integer) : integer		do			if n = 0 then				factorial <- 1			else				factorial <- n * factorial( n - 1 )	do		[msg <- "Factorial 5 is "		writeString msg		writeInteger factorial(5)		writeLine]'! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'nl 12/7/2024 15:32'!incorrectTypeAssignmentProgram	^'program 	variables		msg : string		do		msg <- 42'! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'nl 12/7/2024 15:05'!multFuncProgram	^'program 	variables		msg : string	methods		function factorial(n:integer) : integer		do			if n = 0 then				factorial <- 1			else				factorial <- n * factorial( n - 1 )						function factorial(n:integer) : integer		do			if n = 0 then				factorial <- 1			else				factorial <- n * factorial( n - 1 )			do		writeString "hello"'! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'nl 12/7/2024 14:40'!multProcProgram	^'program 	variables		msg : string	methods		procedure factorial(n:integer)		do			writeString "hello"		procedure factorial()		do			writeString "hello2"	do		writeString "hello"'! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'nl 12/7/2024 15:09'!nanoBadProgram	^'program do writeString 42'! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'jws 12/2/2024 11:18'!nanoProgram	^'program do writeString "Hello, World!!"'! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'nl 12/7/2024 15:27'!undeclaredProcProgram	^'program 	variables		msg : string		do		factorial()'! !!BigTalkSemanticAnalyzerTestCase methodsFor: 'accessing' stamp: 'nl 12/7/2024 15:08'!undeclaredVariablesProgram	^'program 	do 		[answer <- 42		writeInteger answer]'! !